<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Interactive origami folding demo that responds to device posture."
    />
    <meta name="theme-color" content="#201a14" />
    <title>kami: Origami simulator</title>
    <!-- Add Material Symbols Font -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <meta property="og:image" content="https://maxwase.github.io/kami/og.png" />
    <link rel="icon" type="image/png" href="icon.png" />
    <link
      rel="stylesheet"
      id="silktide-consent-manager-css"
      href="cookie-banner/silktide-consent-manager.css"
    />
    <style>
      /* Hide floating cookie icon; settings menu provides entry point */
      #silktide-cookie-icon {
        display: none !important;
      }
    </style>
    <script src="cookie-banner/silktide-consent-manager.js"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }

      gtag("consent", "default", {
        ad_storage: "denied",
        ad_user_data: "denied",
        ad_personalization: "denied",
        analytics_storage: "denied",
      });
    </script>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-C507EG5TKF"
    ></script>
    <script>
      gtag("js", new Date());
      gtag("config", "G-C507EG5TKF");
    </script>
    <script>
      silktideCookieBannerManager.updateCookieBannerConfig({
        background: {
          showBackground: true,
        },
        cookieIcon: {
          position: "bottomLeft",
        },
        cookieTypes: [
          {
            id: "necessary",
            name: "Necessary",
            description:
              "<p>These cookies are necessary for the website to function properly and cannot be switched off. They help with things like logging in and setting your privacy preferences.</p>",
            required: true,
            onAccept: function () {
              console.log("Add logic for the required Necessary here");
            },
          },
          {
            id: "analytics",
            name: "Analytics",
            description:
              "<p>These cookies help us improve the site by tracking which pages are most popular and how visitors move around the site.</p>",
            defaultValue: true,
            onAccept: function () {
              gtag("consent", "update", {
                analytics_storage: "granted",
              });
              dataLayer.push({
                event: "consent_accepted_analytics",
              });
            },
            onReject: function () {
              gtag("consent", "update", {
                analytics_storage: "denied",
              });
            },
          },
          {
            id: "advertising",
            name: "Advertising",
            description:
              "<p>These cookies provide extra features and personalization to improve your experience. They may be set by us or by partners whose services we use.</p>",
            onAccept: function () {
              gtag("consent", "update", {
                ad_storage: "granted",
                ad_user_data: "granted",
                ad_personalization: "granted",
              });
              dataLayer.push({
                event: "consent_accepted_advertising",
              });
            },
            onReject: function () {
              gtag("consent", "update", {
                ad_storage: "denied",
                ad_user_data: "denied",
                ad_personalization: "denied",
              });
            },
          },
        ],
        text: {
          banner: {
            description:
              '<p>We use cookies on our site to enhance your user experience, provide personalized content, and analyze our traffic. <a href="https://maxwase.github.io/kami/cookie-policy" target="_blank">Cookie Policy.</a></p>',
            acceptAllButtonText: "Accept all",
            acceptAllButtonAccessibleLabel: "Accept all cookies",
            rejectNonEssentialButtonText: "Reject non-essential",
            rejectNonEssentialButtonAccessibleLabel: "Reject non-essential",
            preferencesButtonText: "Preferences",
            preferencesButtonAccessibleLabel: "Toggle preferences",
          },
          preferences: {
            title: "Customize your cookie preferences",
            description:
              "<p>We respect your right to privacy. You can choose not to allow some types of cookies. Your cookie preferences will apply across our website.</p>",
            creditLinkText: "Get this banner for free",
            creditLinkAccessibleLabel: "Get this banner for free",
          },
        },
      });
    </script>
  </head>

  <body>
    <canvas id="c"></canvas>

    <!-- Control Footer (Top Left/Right on desktop, Bottom on portrait) -->
    <div id="control-footer">
      <!-- Action Island -->
      <div id="action-island">
        <div class="action-btn-group">
          <button id="resetActive" type="button" title="Reset">
            <span class="material-symbols-outlined">delete_outline</span>
            <span>Reset</span>
          </button>
          <button id="undo" type="button" disabled title="Undo">
            <span class="material-symbols-outlined">undo</span>
            <span>Undo</span>
          </button>
        </div>
        <div class="action-btn-group">
          <button id="foldFallback" type="button" title="Fold">
            <span class="material-symbols-outlined">devices_fold</span>
            <span>Fold</span>
          </button>
          <button id="flipPaper" type="button" title="Flip">
            <span class="material-symbols-outlined">flip</span>
            <span>Flip</span>
          </button>
        </div>
      </div>

      <!-- Settings & Info Buttons -->
      <div id="settings-btn-container">
        <button
          id="toggleSettings"
          type="button"
          aria-controls="settingsPanel"
          aria-pressed="false"
          aria-label="Settings"
          title="Settings"
        >
          <span class="material-symbols-outlined">settings</span>
          <span>Settings</span>
        </button>
        <button
          id="toggleInfo"
          type="button"
          aria-controls="infoPanel"
          aria-pressed="false"
          aria-label="Info"
          title="Info"
        >
          <span class="material-symbols-outlined">info</span>
          <span>Info</span>
        </button>
      </div>
    </div>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="settings-panel" style="display: none">
      <h3>Settings</h3>

      <div class="settings-section">
        <h4>Motion</h4>
        <div class="input-group">
          <div class="input-row mono">
            <span>Stability:</span>
            <span id="stableAccelValue">0.35 m/sÂ²</span>
            <input
              id="stableAccel"
              type="range"
              class="styled-range"
              min="0"
              max="3"
              step="0.05"
              value="0.35"
            />
          </div>
          <label
            class="checkbox-label"
            title="Reverse which side the fold prefers to move toward when triggered"
          >
            <input id="invertFoldDirection" type="checkbox" />
            Invert fold direction
          </label>
        </div>
      </div>

      <div class="settings-section">
        <div class="section-header">
          <h4>Hinge</h4>
          <button
            id="resetHinge"
            type="button"
            class="reset-inline-btn"
            title="Reset axis"
            aria-label="Reset axis"
          >
            <span class="material-symbols-outlined icon-small">restart_alt</span>
          </button>
        </div>
        <div class="input-group">
          <div class="input-row mono">
            <span class="hinge-label"
              ><span>X:</span> <span id="hingeXValue"></span
            ></span>
            <input
              id="manualHingeX"
              type="range"
              class="styled-range"
              min="0"
              max="100"
              step="1"
              value="50"
            />
          </div>
          <div class="input-row mono">
            <span class="hinge-label"
              ><span>Y:</span> <span id="hingeYValue"></span
            ></span>
            <input
              id="manualHingeY"
              type="range"
              class="styled-range"
              min="0"
              max="100"
              step="1"
              value="50"
            />
          </div>
          <label class="checkbox-label">
            <input id="manualHingeFlip" type="checkbox" />
            Flip hinge line
          </label>
        </div>
      </div>

      <div class="settings-section">
        <h4>Style</h4>
        <div class="input-group">
          <div class="paper-size-selector">
            <div class="toggle-group">
              <label
                ><input type="radio" name="paperSize" value="a4" checked /> A4</label
              >
              <label
                ><input type="radio" name="paperSize" value="square" /> Square</label
              >
              <label
                ><input type="radio" name="paperSize" value="custom" /> Custom</label
              >
            </div>
            <div
              id="customAspectInputs"
              class="custom-aspect-inputs"
              style="display: none"
            >
              <div class="input-row mono">
                <label for="customWidth">W:</label>
                <input
                  id="customWidth"
                  type="number"
                  min="0.1"
                  max="100"
                  step="0.1"
                  value="3"
                  class="aspect-input"
                />
                <span>:</span>
                <label for="customHeight">H:</label>
                <input
                  id="customHeight"
                  type="number"
                  min="0.1"
                  max="100"
                  step="0.1"
                  value="4"
                  class="aspect-input"
                />
              </div>
            </div>
          </div>
          <label class="checkbox-label">
            <input type="checkbox" id="showPaperBorder" checked />
            Show paper border
          </label>
          <div class="input-row">
            <label for="paperFrontColor">Front color</label>
            <div class="color-picker-wrapper">
              <input id="paperFrontColor" type="color" value="#ffffff" />
              <div
                class="color-picker-display"
                id="paperFrontColorDisplay"
                style="background-color: #ffffff"
              ></div>
            </div>
          </div>
          <div class="input-row">
            <label for="paperBackColor">Back color</label>
            <div class="color-picker-wrapper">
              <input id="paperBackColor" type="color" value="#f0f0f0" />
              <div
                class="color-picker-display"
                id="paperBackColorDisplay"
                style="background-color: #f0f0f0"
              ></div>
            </div>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <h4>Privacy</h4>
        <div class="input-group">
          <div class="toggle-group">
            <button id="openCookiePreferences" type="button" class="toggle-button">
              <span class="material-symbols-outlined icon-small" aria-hidden="true"
                >cookie</span
              >
              <span>Manage cookie preferences</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Info Panel -->
    <div id="infoPanel" class="settings-panel" style="display: none">
      <h3>Info</h3>

      <div class="test-controls-section">
        <div id="foldHelp"></div>
        <div id="gestureHelp"></div>
        <div class="mono" id="status" role="status" aria-live="polite"></div>
      </div>

      <details class="debug-spoiler">
        <summary>Debug</summary>
        <div class="mono" id="debugStatus" role="status"></div>
      </details>

      <div class="settings-footer">
        <a id="buyCoffee" href="https://www.buymeacoffee.com/maxwase" target="_blank">
          <img
            src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png"
            alt="Buy Me A Coffee"
            style="height: 32px; width: auto"
          />
        </a>
        <a
          id="repoLink"
          href="https://github.com/maxwase/kami"
          target="_blank"
          rel="noreferrer"
          class="footer-link"
        >
          <span class="material-symbols-outlined icon-small">code</span>
          <span>GitHub source</span>
        </a>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const openCookiePreferences = document.getElementById("openCookiePreferences");
        if (openCookiePreferences) {
          openCookiePreferences.addEventListener("click", () => {
            // Ensure the banner is initialized
            if (window.silktideCookieBannerManager?.initCookieBanner) {
              window.silktideCookieBannerManager.initCookieBanner();
            }
            // Open the modal via the existing banner control
            const cookieIcon = document.getElementById("silktide-cookie-icon");
            cookieIcon?.click();
          });
        }
      });
    </script>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
